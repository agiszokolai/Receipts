import{a as q,b as G,c as J,f as X}from"./chunk-RMTLDSYJ.js";import{e as Q}from"./chunk-FZJ6PQ3K.js";import{a as Z}from"./chunk-NHIW3AEF.js";import{E as j,G as K,H as P,a as Y}from"./chunk-TMOWURAR.js";import{Ab as T,Ba as S,Da as m,Ea as c,G as f,Ha as l,Ia as u,Ja as I,K as v,L as _,La as V,Ra as D,Sa as w,T as g,Ta as $,X as x,_ as o,cb as B,ea as U,i as O,ia as M,jb as L,k as F,ma as d,qa as E,rb as A,sa as R,ta as h,ua as k,ub as N,v as b,va as a,wa as r,x as z,xa as C,y as H,yb as W}from"./chunk-TQGG3II2.js";var ie=(n,i)=>i.sectionName,ne=(n,i,e)=>({easy:n,medium:i,hard:e}),re=n=>({saved:n}),ee=(n,i)=>({"fa-solid":n,"fa-regular":i}),ae=(n,i)=>({filled:n,hovered:i});function se(n,i){if(n&1&&(a(0,"span",19),l(1),r()),n&2){let e=i.$implicit;o(),u(e)}}function oe(n,i){if(n&1&&(a(0,"li",41),l(1),r()),n&2){let e=i.$implicit;o(),I(" ",e," ")}}function le(n,i){if(n&1&&(a(0,"li",52),l(1),r()),n&2){let e=i.$implicit;o(),V("",e.amount," ",e.unit," ",e.name,"")}}function ce(n,i){if(n&1&&(a(0,"div",44)(1,"strong"),l(2),r(),a(3,"ul"),h(4,le,2,3,"li",52,R),r()()),n&2){let e=i.$implicit;o(2),u(e.sectionName),o(2),k(e.ingredients)}}function pe(n,i){if(n&1){let e=S();a(0,"i",53),m("click",function(){let s=v(e).$implicit,p=c();return _(p.setRating(s))})("keyup",function(){let s=v(e).$implicit,p=c();return _(p.setRating(s))})("mouseenter",function(){let s=v(e).$implicit,p=c();return _(p.hoverIndex=s)})("mouseleave",function(){v(e);let s=c();return _(s.hoverIndex=0)}),r()}if(n&2){let e=i.$implicit,t=c();d("ngClass",w(1,ae,e<=t.rating,e<=t.hoverIndex))}}function de(n,i){if(n&1){let e=S();a(0,"div",49)(1,"button",54),m("click",function(){v(e);let s=c();return _(s.saveRating())}),l(2,"\xC9rt\xE9kel\xE9s ment\xE9se"),r()()}}function me(n,i){if(n&1){let e=S();a(0,"app-authentication-warning-modal",55),m("closeModal",function(){v(e);let s=c();return _(s.isModalOpen.set(!1))}),r()}if(n&2){let e=c();d("isModalOpen",e.isModalOpen())}}function ue(n,i){if(n&1){let e=S();a(0,"app-save-recipe",56),m("closeEvent",function(){v(e);let s=c();return _(s.isSaveModalOpen.set(!1))})("saveEvent",function(s){v(e);let p=c();return _(p.handleSaveEvent(s))}),r()}if(n&2){let e=c();d("isModalOpen",e.isSaveModalOpen())("user",e.user())("recipe",e.receipt)}}var te=class n{receipt;creator;user=g(null);isLiked=g(!1);isSaved=g(!1);isModalOpen=g(!1);isSaveModalOpen=g(!1);isLoginModalOpen=g(!1);isRegistrationModalOpen=g(!1);blankFood=T;isHeartHovered=!1;isBookMarkHovered=!1;rating=0;isRatingChanged=!1;hoverIndex=0;likes=0;receiptId=0;filterdReceipts$;stars=[1,2,3,4,5];destroyed$=new O(1);userReceiptService=f(Q);receiptService=f(W);authService=f(P);userService=f(N);searchService=f(Y);router=f(A);toastr=f(j);ngOnInit(){this.receiptId=history.state.id,this.filterdReceipts$=this.searchService.filteredList$,this.authService.user$.pipe(H(this.destroyed$)).subscribe({next:i=>{this.user.set(i),this.receiptId?this.getReceiptData(this.receiptId):this.router.navigate(["receptek"]),i||(this.isLiked.set(!1),this.isSaved.set(!1),this.rating=0)}}),this.router.events.subscribe(()=>{let i=history.state.id;i&&i!==this.receiptId&&(this.receiptId=i,this.getReceiptData(this.receiptId))})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}handleSaveEvent(i){this.isSaveModalOpen.set(!1),this.user.set(i),this.getReceiptStateForUser()}getReceiptData(i){this.receiptService.getReceiptById(i).pipe(z(e=>{if(e){e.imageUrl=e.imageUrl?.length?e.imageUrl:T,this.receipt=e;let t=J(e.createdAt,{formats:["YYYY-MM-DD HH:mm:ss"],useFormat:"YYYY. MM. DD."});return this.receipt.createdAt=t,this.user()&&this.getReceiptStateForUser(),this.userService.getUserById(e.createdById)}return F(null)}),b(1)).subscribe({next:e=>{e&&(this.creator=e)},error:e=>{console.error("Hiba t\xF6rt\xE9nt a recept vagy a szerz\u0151 bet\xF6lt\xE9se k\xF6zben:",e)}})}getReceiptStateForUser(){this.isLiked.set(this.user()?.receipts?.liked?.includes(this.receipt.id)??!1),this.isSaved.set((this.user()?.receipts?.saved?.includes(this.receipt.id)||this.user()?.receipts?.collections?.some(i=>i.receipts.includes(this.receipt.id)))??!1),this.rating=this.receipt.reviews?.find(i=>i.userId===this.user().userId)?.rating??0}updateUserReceipt(i,e){if(!this.user()){this.isModalOpen.set(!0);return}let t=this.user().userId,s=this.receipt.id;i==="save"?e?this.isSaveModalOpen.set(!0):this.userReceiptService.removeSavedReceipt(t,s).pipe(b(1)).subscribe({next:p=>{p&&(this.isSaved.set(!1),this.authService.updateUser(p),this.toastr.success("Sikeresen kiker\xFClt a recept a mentettek k\xF6z\xFCl"))},error:()=>{console.error("Hiba t\xF6rt\xE9nt a recept \xE1llapot\xE1nak megv\xE1ltoztat\xE1sa k\xF6zben:")}}):(e?this.userReceiptService.addLikedReceipt(t,s):this.userReceiptService.removeLikedReceipt(t,s)).pipe(b(1)).subscribe({next:y=>{y&&(this.isLiked.set(e),this.authService.updateUser(y))},error:y=>{console.error("Hiba t\xF6rt\xE9nt a recept \xE1llapot\xE1nak megv\xE1ltoztat\xE1sa k\xF6zben:",y)}})}setRating(i){if(!this.user()){this.isModalOpen.set(!0);return}this.isRatingChanged=this.rating!==i,this.rating=i}addReview(i){this.receiptService.addReview(i,this.receipt.id).subscribe({next:e=>{e&&(this.receipt=e,this.updateAverageRating())},error:e=>{console.error("Hiba t\xF6rt\xE9nt az \xE9rt\xE9kel\xE9s hozz\xE1ad\xE1sa k\xF6zben:",e)}})}updateReview(i){this.receiptService.updateReview(i,this.receipt.id).subscribe({next:e=>{e&&(this.receipt=e,this.updateAverageRating())},error:e=>{console.error("Hiba t\xF6rt\xE9nt az \xE9rt\xE9kel\xE9s friss\xEDt\xE9se k\xF6zben:",e)}})}saveRating(){let i=this.user();if(!i){console.error("Felhaszn\xE1l\xF3 nincs bejelentkezve!");return}let e=this.receipt.reviews?.find(t=>t.userId===i.userId);if(e)e.rating=this.rating,this.updateReview(e);else{let t={id:this.receipt.reviews?.length?this.receipt.reviews.length+1:1,userId:i.userId,username:i.username,likes:0,rating:this.rating,comment:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};this.addReview(t)}this.isRatingChanged=!1}updateAverageRating(){let i=this.receipt.reviews??[];this.receipt.averageRating=i.length>0?i.reduce((e,t)=>e+t.rating,0)/i.length:0}navigateToCreator(){this.router.navigate(["/profil",this.creator.username])}navigateBack(){this.router.navigate([history.state.direction])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=U({type:n,selectors:[["app-receipt"]],decls:77,vars:31,consts:[[1,"receipt-container"],[1,"receipt-header"],[1,"header-left","col-lg-6","col-md-12","col-sm-12"],[1,"back-button-div"],["tabindex","0",3,"click","keyup"],[1,"fa-solid","fa-angle-left","me-2"],[1,"header-container"],[1,"receipt-image-container"],[3,"src","alt"],[1,"category-difficulty-container"],["tooltipStr","Kateg\xF3ria",1,"category"],["tooltipStr","Neh\xE9zs\xE9g",1,"difficulty",3,"ngClass"],[1,"rating","mb-3"],["tooltipStr","\xC1tlagos \xE9rt\xE9kel\xE9s",1,"star"],[1,"fa-solid","fa-star"],["tooltipStr","Kedvel\xE9sek",1,"likes"],[1,"fa-solid","fa-heart"],[1,"receipt-tags"],[1,"tags"],[1,"tag"],[1,"header-right","col-lg-6","col-md-12","col-sm-12"],[1,"name"],[1,"creator-rating"],[1,"creator"],["tabindex","0",1,"creator-img",3,"click","keyup"],["alt","",3,"src"],[1,"date","pt-3"],[1,"receipt-save"],[1,"btn",3,"click","ngClass"],[1,"fa-bookmark","me-2",3,"mouseenter","mouseleave","ngClass"],[1,"icon"],["tabindex","0",1,"fa-heart",3,"click","keyup","mouseenter","mouseleave","ngClass"],[1,"receipt-body"],[1,"d-flex","align-items-center","flex-column","w-100"],[1,"text-center"],[1,"w-85"],[1,"justify-text"],[1,"body-steps-ingredients","mt-3"],[1,"steps-ingredients-container"],[1,"steps","col-lg-8","col-md-6","col-sm-12"],[1,"text-left","mt-4","mb-3"],[1,"my-2"],[1,"ingredients","col-lg-4","col-md-6","col-sm-12"],[1,"ingredientHeader"],[1,"ingredient-section"],[1,"receipt-footer"],[1,"rating"],[1,"stars"],["tabindex","0",1,"fa-solid","fa-star",3,"ngClass"],["appFade",""],[3,"isModalOpen"],[3,"isModalOpen","user","recipe"],[1,"my-2","ingredient"],["tabindex","0",1,"fa-solid","fa-star",3,"click","keyup","mouseenter","mouseleave","ngClass"],[1,"save-btn",3,"click"],[3,"closeModal","isModalOpen"],[3,"closeEvent","saveEvent","isModalOpen","user","recipe"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),m("click",function(){return t.navigateBack()})("keyup",function(){return t.navigateBack()}),C(5,"i",5),l(6,"Vissza "),r()(),a(7,"div",6)(8,"div",7),C(9,"img",8),r(),a(10,"div",9)(11,"span",10),l(12),r(),a(13,"span",11),l(14),r()(),a(15,"div",12)(16,"div",13)(17,"span"),l(18),r(),C(19,"i",14),r(),a(20,"div",15)(21,"span"),l(22),r(),C(23,"i",16),r()(),a(24,"div",17)(25,"div",18),h(26,se,2,1,"span",19,R),r()()()(),a(28,"div",20)(29,"div",21),l(30),r(),a(31,"div",22)(32,"div",23)(33,"div",24),m("click",function(){return t.navigateToCreator()})("keyup",function(){return t.navigateToCreator()}),C(34,"img",25),a(35,"span"),l(36),r()(),a(37,"p",26),l(38),r()()(),a(39,"div")(40,"div",27)(41,"button",28),m("click",function(){return t.updateUserReceipt("save",!t.isSaved())}),a(42,"i",29),m("mouseenter",function(){return t.isBookMarkHovered=!0})("mouseleave",function(){return t.isBookMarkHovered=!1}),r(),l(43),r(),a(44,"div",30)(45,"i",31),m("click",function(){return t.updateUserReceipt("like",!t.isLiked())})("keyup",function(){return t.updateUserReceipt("like",!t.isLiked())})("mouseenter",function(){return t.isHeartHovered=!0})("mouseleave",function(){return t.isHeartHovered=!1}),r()()()()()(),a(46,"div",32)(47,"div",33)(48,"h4",34),l(49,"Le\xEDr\xE1s"),r(),a(50,"div",35)(51,"p",36),l(52),r()()(),a(53,"div",37)(54,"div",38)(55,"div",39)(56,"span",40),l(57,"Elk\xE9sz\xEDt\xE9s"),r(),a(58,"ol"),h(59,oe,2,1,"li",41,R),r()(),a(61,"div",42)(62,"div",43)(63,"span"),l(64,"Hozz\xE1val\xF3k"),r()(),h(65,ce,6,1,"div",44,ie),r()()()(),a(67,"div",45)(68,"div",46)(69,"div"),l(70,"\xC9rt\xE9keld a receptet"),r(),a(71,"div",47),h(72,pe,1,4,"i",48,R),r(),M(74,de,3,0,"div",49),r()()(),M(75,me,1,1,"app-authentication-warning-modal",50)(76,ue,1,3,"app-save-recipe",51)),e&2&&(o(9),d("src",t.receipt.imageUrl,x)("alt",t.receipt.name),o(3),u(t.receipt.category),o(),d("ngClass",$(19,ne,t.receipt.difficulty==="K\xF6nny\u0171",t.receipt.difficulty==="K\xF6zepes",t.receipt.difficulty==="Neh\xE9z")),o(),u(t.receipt.difficulty),o(4),I(" ",t.receipt.averageRating,""),o(4),u(t.receipt.likes),o(4),k(t.receipt.tags),o(4),u(t.receipt.name),o(4),d("src",t.creator.profilePictureUrl,x),o(2),u(t.creator.name),o(2),u(t.receipt.createdAt),o(3),d("ngClass",D(23,re,t.isSaved())),o(),d("ngClass",w(25,ee,t.isSaved()||t.isBookMarkHovered,!(t.isSaved()||t.isBookMarkHovered))),o(),I("",t.isSaved()?"Recept mentve":"Recept ment\xE9se"," "),o(2),d("ngClass",w(28,ee,t.isLiked()||t.isHeartHovered,!(t.isLiked()||t.isHeartHovered))),o(7),u(t.receipt.description),o(7),k(t.receipt.steps),o(6),k(t.receipt.ingredients),o(7),k(t.stars),o(2),E(t.isRatingChanged?74:-1),o(),E(t.isModalOpen()?75:-1),o(),E(t.isSaveModalOpen()?76:-1))},dependencies:[L,B,G,K,q,X,Z],encapsulation:2})};export{te as ReceiptComponent};
